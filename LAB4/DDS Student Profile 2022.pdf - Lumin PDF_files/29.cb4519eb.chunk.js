(window.webpackJsonp=window.webpackJsonp||[]).push([[29],{"./src/lumin-components/SignatureOverlayLumin/index.js":function(e,t,n){"use strict";n.r(t);var a=n("./node_modules/react-redux/es/index.js"),r=n("./node_modules/react-i18next/dist/es/withTranslation.js"),s=n("./node_modules/recompose/dist/Recompose.esm.js"),o=n("./node_modules/react-router/esm/react-router.js"),i=n("./src/redux/actions/index.js"),u=n("./src/redux/selectors/index.js"),c=n("./node_modules/@babel/runtime/helpers/classCallCheck.js"),l=n.n(c),d=n("./node_modules/@babel/runtime/helpers/createClass.js"),m=n.n(d),p=n("./node_modules/@babel/runtime/helpers/assertThisInitialized.js"),g=n.n(p),f=n("./node_modules/@babel/runtime/helpers/inherits.js"),S=n.n(f),h=n("./node_modules/@babel/runtime/helpers/possibleConstructorReturn.js"),v=n.n(h),E=n("./node_modules/@babel/runtime/helpers/getPrototypeOf.js"),b=n.n(E),y=n("./node_modules/@babel/runtime/helpers/defineProperty.js"),x=n.n(y),C=n("./node_modules/react/index.js"),j=n.n(C),w=n("./node_modules/prop-types/index.js"),N=n.n(w),O=n("./src/lumin-components/MaterialPopper/index.js"),I=n("./node_modules/@apollo/react-hoc/lib/react-hoc.esm.js"),U=n("./node_modules/react-onclickoutside/dist/react-onclickoutside.es.js"),T=n("./node_modules/@babel/runtime/regenerator/index.js"),R=n.n(T),k=n("./node_modules/@babel/runtime/helpers/asyncToGenerator.js"),_=n.n(k),A=n("./src/core/index.js"),D=n("./src/helpers/getClassName.js"),M=n("./src/constants/defaultTool.js"),P=n("./src/utils/index.js"),L=n("./src/graphql/UserGraph.js"),z=[window.Tools.ToolNames.DISTANCE_MEASUREMENT,window.Tools.ToolNames.PERIMETER_MEASUREMENT,window.Tools.ToolNames.AREA_MEASUREMENT,window.Tools.ToolNames.RECTANGULAR_AREA_MEASUREMENT,window.Tools.ToolNames.ELLIPSE_MEASUREMENT],F=function(e,t,n){var a=[];if(z.includes(e)&&"StrokeColor"!==t&&"Opacity"!==t)a=z.map(A.default.getTool);else{var r=A.default.getTool(e);r&&a.push(r)}a.forEach((function(e){e.setStyles(x()({},t,n))}))},W=n("./src/constants/lumin-common.js"),q=n("./src/lumin-components/SvgElement/index.js"),B=n("./src/lumin-components/Icomoon/index.js"),G={signatureIndex:N.a.number,signatureItem:N.a.object,activeSignatureIndex:N.a.number,deletingIndex:N.a.number,isCreatedFrame:N.a.bool,openCreateSignatureModal:N.a.func,onClick:N.a.func,onDoubleClick:N.a.func,onDeleteSignature:N.a.func,isDisable:N.a.bool},H=function(e){var t=e.signatureIndex,n=e.signatureItem,a=e.activeSignatureIndex,r=e.deletingIndex,s=e.isCreatedFrame,o=e.openCreateSignatureModal,i=e.onClick,u=e.onDoubleClick,c=e.onDeleteSignature,l=e.isDisable;return s?j.a.createElement("div",{className:"SignatureItemWrapper"},j.a.createElement("div",{className:"SignatureItemContainer ".concat(l?"SignatureItemContainer__disable":""),onClick:o,role:"button"},j.a.createElement("div",{className:"SignatureItemDetail create-new-sign ".concat(l?"create-new-sign__disable":"")},j.a.createElement(B.a,{className:"add",size:"16"}),j.a.createElement("span",{className:"label"},"Add New")))):j.a.createElement("div",{className:"SignatureItemWrapper"},j.a.createElement("div",{className:"SignatureItemContainer"},j.a.createElement("div",{className:"SignatureItemDetail ".concat(a===t?"selected":""," ").concat(a!==t?"nonselect-border":""," ").concat(r===t?"blur":""),onClick:i,onDoubleClick:u},j.a.createElement(B.a,{className:"delete-sign",size:12,color:"#8093a7",onClick:c}),n.isErrorSignature?j.a.createElement(q.a,{content:"crash",width:48,height:64}):j.a.createElement("img",{src:n.imgSrc,alt:"signature-item",className:"SignatureItemDetail__SavedSign"}))))};H.defaultProps={signatureIndex:-1,activeSignatureIndex:0,signatureItem:{},deletingIndex:0,isCreatedFrame:!1,openCreateSignatureModal:function(){},onClick:function(){},onDoubleClick:function(){},onDeleteSignature:function(){},isDisable:!1},H.propTypes=G;var Y=H,J=n("./src/constants/urls.js"),X=n("./src/constants/plan.js");function K(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,a)}return n}function Q(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?K(Object(n),!0).forEach((function(t){x()(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):K(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function V(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,a=b()(e);if(t){var r=b()(this).constructor;n=Reflect.construct(a,arguments,r)}else n=a.apply(this,arguments);return v()(this,n)}}var Z={closeElement:N.a.func.isRequired,openElement:N.a.func.isRequired,match:N.a.object.isRequired,currentUser:N.a.object,userSignatures:N.a.array,client:N.a.object.isRequired,setCurrentUser:N.a.func.isRequired,history:N.a.object,openModal:N.a.func,anchorEl:N.a.object,organizations:N.a.object,updateCurrentUser:N.a.func.isRequired},$=function(e){S()(n,e);var t=V(n);function n(e){var a;return l()(this,n),a=t.call(this,e),x()(g()(a),"handleClickOutside",(function(e){var t=a.props,n=t.anchorEl,r=t.closeElement;n.contains(e.target)||r("signatureOverlay")})),x()(g()(a),"openCreateSignatureModal",_()(R.a.mark((function e(){var t,n,r,s,o,i,u,c;return R.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:t=a.props,n=t.closeElement,r=t.openElement,s=t.currentUser,o=t.match,i=t.openModal,"5cf1b9ee7ba93440bd685ea2"!==(u=o.params.documentId)&&"tour"!==u||s?r("signatureModal"):(c={type:W.A.WARNING,title:"Limit on creating a new signature",message:"You can create a signature only when you log in to Lumin PDF.",isCustomModal:!0,firstButtonTitle:"Go to Guide",onFirstButtonClick:function(){window.open("".concat(J.j,"/guide/annotation-tools/add-signature"))},secondButtonTitle:"Login",onSecondButtonClick:function(){window.open("/authentication/signin")}},i(c)),n("signatureOverlay");case 4:case"end":return e.stop()}}),e)})))),x()(g()(a),"setUpSignature",_()(R.a.mark((function e(){var t,n,r,s,o,i,u,c,l;return R.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t=a.state.activeSignatureIndex,n=a.props,r=n.closeElement,s=n.userSignatures,o=n.updateCurrentUser,i=n.currentUser,u=Q(Q({},i),{},{metadata:Q(Q({},i.metadata),{},{hasShownBananaBanner:!0})}),-1!==t){e.next=5;break}return e.abrupt("return");case 5:if((c=s[t])&&!c.isErrorSignature){e.next=8;break}return e.abrupt("return");case 8:return l=c.imgSrc,A.default.setToolMode("AnnotationCreateSignature"),F("AnnotationCreateSignature","Opacity",1),e.next=13,A.default.getTool("AnnotationCreateSignature").setSignature(l);case 13:A.default.getTool("AnnotationCreateSignature").showPreview(),r("signatureSavedModal"),o(u);case 16:case"end":return e.stop()}}),e)})))),x()(g()(a),"deleteDefaultSignature",(function(e){var t=a.props,n=t.client,r=t.setCurrentUser;a.setState({activeSignatureIndex:-1}),n.mutate({mutation:L.h,variables:{index:e}}).then((function(e){r(e.data.deleteSignatureByIndex)})).catch((function(e){console.log(e)})).finally((function(){}))})),x()(g()(a),"closeModal",(function(){a.props.closeElement("signatureOverlay"),A.default.setToolMode(M.a)})),x()(g()(a),"setActiveSignature",function(){var e=_()(R.a.mark((function e(t){var n,r,s,o,i;return R.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(a.setState({activeSignatureIndex:t}),n=a.props,r=n.closeElement,s=n.userSignatures,-1!==t){e.next=4;break}return e.abrupt("return");case 4:if((o=s[t])&&!o.isErrorSignature){e.next=7;break}return e.abrupt("return");case 7:return i=o.imgSrc,A.default.setToolMode("AnnotationCreateSignature"),F("AnnotationCreateSignature","Opacity",1),e.next=12,A.default.getTool("AnnotationCreateSignature").setSignature(i);case 12:A.default.getTool("AnnotationCreateSignature").showPreview(),r("signatureSavedModal"),a.props.closeElement("signatureOverlay");case 15:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()),x()(g()(a),"updateDeletingIndex",(function(){a.setState({deletingIndex:-1})})),x()(g()(a),"_handleDeleteSignature",(function(e,t){e.stopPropagation(),-1!==a.state.deletingIndex&&a.isTourDocument||a.setState({deletingIndex:t},(function(){a.deleteDefaultSignature(t)}))})),x()(g()(a),"renderEmptySignature",(function(){return j.a.createElement("div",{className:"empty-signature",onClick:a.openCreateSignatureModal},j.a.createElement(B.a,{className:"add icon__20 empty-signature-icon"}),j.a.createElement("div",{className:"no-saved-label"},"Add New Signature"))})),x()(g()(a),"renderListSignature",(function(){var e=a.state,t=e.activeSignatureIndex,n=e.deletingIndex,r=e.maximumNumberSignature,s=a.props.userSignatures,o=s.length;return j.a.createElement("div",{className:"list-signature-wrapper"},j.a.createElement(Y,{isCreatedFrame:!0,openCreateSignatureModal:a.openCreateSignatureModal,isDisable:o>=r}),s.map((function(e,r){return j.a.createElement(Y,{key:r,signatureIndex:r,signatureItem:e,activeSignatureIndex:t,deletingIndex:n,onClick:function(){return a.setActiveSignature(r)},onDeleteSignature:function(e){return a._handleDeleteSignature(e,r)}})})))})),x()(g()(a),"getTextHeader",(function(){var e=a.state.maximumNumberSignature;return a.props.userSignatures.length>=e?e!==W.x.PREMIUM_PLAN?j.a.createElement(j.a.Fragment,null,j.a.createElement("span",null," To add more, please "),j.a.createElement("span",{className:"upgrade-message",onClick:function(){return a.props.history.push("/plans")}},"Upgrade Your Plan")):j.a.createElement(j.a.Fragment,null,j.a.createElement("span",{className:"red-mess"}," ","Please remove some signatures to add more.")):null})),a.overlay=j.a.createRef(),a.isTourDocument="5cf1b9ee7ba93440bd685ea2"===e.match.params.documentId||"tour"===e.match.params.documentId,a.state={activeSignatureIndex:-1,deletingIndex:-1,maximumNumberSignature:W.x.FREE_PLAN},a}return m()(n,[{key:"componentDidMount",value:function(){window.addEventListener("resize",this.handleWindowResize);var e=this.props,t=e.currentUser,n=e.organizations,a=t?Object(P.w)(t,n.data):"tour";this.setUpPlan(a)}},{key:"componentDidUpdate",value:function(e){var t=e.userSignatures,n=this.props,a=n.currentUser,r=n.userSignatures,s=n.organizations,o=void 0===s?{}:s,i=a?Object(P.w)(a,o.data):"tour";t.length>r.length&&this.updateDeletingIndex(),this.setUpPlan(i)}},{key:"componentWillUnmount",value:function(){window.removeEventListener("resize",this.handleWindowResize)}},{key:"setUpPlan",value:function(e){switch(e){case X.k.FREE:this.setState({maximumNumberSignature:W.x.FREE_PLAN});break;case X.k.FREE_TRIAL:case X.k.FREE_TRIAL_30:case X.k.PERSONAL:case X.k.PROFESSIONAL:this.setState({maximumNumberSignature:W.x.PREMIUM_PLAN});break;default:this.setState({maximumNumberSignature:W.x.TOUR})}}},{key:"render",value:function(){var e=this.state.maximumNumberSignature,t=this.props.userSignatures,n=Object(D.a)("Modal SignatureSavedModal",{isOpen:!0}),a=t.length;return j.a.createElement("div",{className:n},j.a.createElement("div",{className:"container"},j.a.createElement("div",{className:"SignatureSavedModal__header-container"},j.a.createElement("div",{className:"header"},j.a.createElement("span",{className:"header-label"},"Saved Signatures")),j.a.createElement("div",{className:"sub-header"},j.a.createElement("span",{className:"sub-header-label"},j.a.createElement(j.a.Fragment,null,j.a.createElement("span",null,"You have added ".concat(a," of ").concat(e," available signatures. ")),this.getTextHeader())))),0!==a&&j.a.createElement("div",{className:"divider horizontal"}),j.a.createElement("div",{className:"saved-signature-container"},0===a?this.renderEmptySignature():this.renderListSignature())))}}]),n}(j.a.PureComponent);$.propTypes=Z,$.defaultProps={currentUser:{},history:{},userSignatures:[],openModal:function(){},anchorEl:{},organizations:{}};var ee=$,te=Object(s.a)(Object(a.c)((function(e){return{userSignatures:u.a.getUserSignatures(e),activeToolStyles:u.a.getActiveToolStyles(e),currentUser:u.a.getCurrentUser(e),organizations:u.a.getOrganizationList(e)}}),(function(e){return{openModal:function(t){return e(i.a.openModal(t))},closeElements:function(t){return e(i.a.closeElements(t))},closeElement:function(t){return e(i.a.closeElement(t))},openElement:function(t){return e(i.a.openElement(t))},setCurrentUser:function(t){return e(i.a.setCurrentUser(t))},updateCurrentUser:function(t){return e(i.a.updateCurrentUser(t))}}})),I.a,o.l,Object(r.a)(),U.a)(ee),ne=n("./src/constants/socketConstant.js"),ae=n("./src/socket/index.js");function re(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,a=b()(e);if(t){var r=b()(this).constructor;n=Reflect.construct(a,arguments,r)}else n=a.apply(this,arguments);return v()(this,n)}}var se={isOpen:N.a.bool,isDisabled:N.a.bool,closeElements:N.a.func.isRequired,currentUser:N.a.object,setCurrentUser:N.a.func.isRequired},oe=function(e){S()(n,e);var t=re(n);function n(e){var a;return l()(this,n),a=t.call(this,e),x()(g()(a),"updateSavedSignatures",(function(e){var t=e.currentUser,n=e.type,a=e.updatedSignature;P.F.initSignature({currentUser:t,type:n,updatedSignature:a})})),x()(g()(a),"getAnchorEl",(function(){var e=document.querySelector("[data-element=signatureToolButton]");a.setState({anchorEl:e})})),x()(g()(a),"handleWindowResize",(function(){a.getAnchorEl()})),a.signatureTool=A.default.getTool("AnnotationCreateSignature"),a.MAX_DEFAULT_SIGNATURES=2,a.currentSignatureIndex=-1,a.state={anchorEl:null},a}return m()(n,[{key:"componentDidMount",value:function(){var e=this;window.addEventListener("resize",this.handleWindowResize),this.props.currentUser&&ae.a.on("".concat(ne.b.ADD_NEW_SIGNATURE,"-").concat(this.props.currentUser._id),(function(t){var n=t.user;e.props.setCurrentUser(n)}))}},{key:"componentDidUpdate",value:function(e){!e.isOpen&&this.props.isOpen&&(this.props.closeElements(["viewControlsOverlay","menuOverlay","toolsOverlay","zoomOverlay","toolStylePopup"]),this.getAnchorEl());var t=e.currentUser,n=this.props.currentUser;if(t&&t.signatures&&n&&t.signatures.length!==n.signatures.length){var a=n;if(t.signatures.length<n.signatures.length){var r=n.signatures.filter((function(e){return!t.signatures.some((function(t){return t===e}))}))[0];this.updateSavedSignatures({currentUser:a,type:"create",updatedSignature:r})}else{var s=t.signatures.filter((function(e){return!n.signatures.some((function(t){return e===t}))}))[0];this.updateSavedSignatures({currentUser:a,type:"delete",updatedSignature:s})}}}},{key:"componentWillUnmount",value:function(){window.removeEventListener("resize",this.handleWindowResize)}},{key:"render",value:function(){var e=this.state.anchorEl,t=this.props,n=t.isDisabled,a=t.isOpen;return n||void 0===a||!e?null:j.a.createElement(O.a,{open:a,anchorEl:e,handleClose:function(){}},j.a.createElement(te,{anchorEl:e}))}}]),n}(j.a.PureComponent);oe.propTypes=se,oe.defaultProps={isOpen:!1,isDisabled:!1,currentUser:{}};var ie=oe;t.default=Object(s.a)(Object(a.c)((function(e){return{isDisabled:u.a.isElementDisabled(e,"signatureOverlay"),currentUser:u.a.getCurrentUser(e),isOpen:u.a.isElementOpen(e,"signatureOverlay"),activeHeaderItems:u.a.getActiveHeaderItems(e),toolButtonObjects:u.a.getToolButtonObjects(e),activeToolName:u.a.getActiveToolName(e),userSignatures:u.a.getUserSignatures(e)}}),(function(e){return{openModal:i.a.openModal,closeElements:i.a.closeElements,openElement:i.a.openElement,setCurrentUser:function(t){return e(i.a.setCurrentUser(t))}}})),o.l,Object(r.a)())(ie)}}]);