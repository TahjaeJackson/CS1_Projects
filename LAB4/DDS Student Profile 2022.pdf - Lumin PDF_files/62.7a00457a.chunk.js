(window.webpackJsonp=window.webpackJsonp||[]).push([[62],{"./src/helpers/getAnnotationStyles.js":function(e,t,n){"use strict";var a=n("./src/core/index.js");t.a=function(e){var t={};return["FillColor","StrokeColor","TextColor","Opacity","StrokeThickness","FontSize","Precision","Scale","Style","Font","FontStyle"].forEach((function(n){var a=e[n];null!==a&&void 0!==a&&(t[n]=e[n])})),"highlight"!==e.elementName||a.default.isBlendModeSupported(e.BlendMode)||(t.Opacity=null),e instanceof window.Annotations.RedactionAnnotation&&(t.Opacity=null,t.StrokeThickness=null,t.FontSize=null),t}},"./src/lumin-components/AnnotationStylePopup/index.js":function(e,t,n){"use strict";var a=n("./src/redux/actions/index.js"),o=n("./src/redux/selectors/index.js"),r=n("./node_modules/react-redux/es/index.js"),s=n("./node_modules/@babel/runtime/helpers/classCallCheck.js"),c=n.n(s),i=n("./node_modules/@babel/runtime/helpers/createClass.js"),u=n.n(i),l=n("./node_modules/@babel/runtime/helpers/assertThisInitialized.js"),d=n.n(l),m=n("./node_modules/@babel/runtime/helpers/inherits.js"),f=n.n(m),p=n("./node_modules/@babel/runtime/helpers/possibleConstructorReturn.js"),v=n.n(p),b=n("./node_modules/@babel/runtime/helpers/getPrototypeOf.js"),g=n.n(b),h=n("./node_modules/@babel/runtime/helpers/defineProperty.js"),j=n.n(h),E=n("./node_modules/react/index.js"),y=n.n(E),O=n("./node_modules/prop-types/index.js"),C=n.n(O),w=n("./node_modules/lodash/debounce.js"),S=n.n(w),R=n("./src/lumin-components/StylePalette/index.js"),N=n("./src/core/index.js"),x=n("./src/helpers/getClassName.js"),P=n("./src/helpers/device.js"),I=n("./src/constants/map.js");function _(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,a=g()(e);if(t){var o=g()(this).constructor;n=Reflect.construct(a,arguments,o)}else n=a.apply(this,arguments);return v()(this,n)}}var A={isDisabled:C.a.bool,annotation:C.a.object.isRequired,style:C.a.object.isRequired,closeElement:C.a.func.isRequired,placement:C.a.string},D=function(e){f()(n,e);var t=_(n);function n(e){var a;return c()(this,n),a=t.call(this,e),j()(d()(a),"handleStyleChange",(function(e,t){var n=a.props.annotation;N.default.setAnnotationStyles(n,j()({},e,t))})),j()(d()(a),"handleClick",(function(e){Object(P.m)()&&e.target===e.currentTarget&&a.props.closeElement("annotationPopup")})),a.debounceHandleStyleChange=S()(a.handleStyleChange,500),a}return u()(n,[{key:"render",value:function(){var e=this.props,t=e.isDisabled,n=e.annotation,a=e.style,o=e.placement,r=n instanceof window.Annotations.FreeTextAnnotation&&n.getIntent()===window.Annotations.FreeTextAnnotation.Intent.FreeText,s="Signature"===n.Subject&&n instanceof window.Annotations.StampAnnotation,c=Object(x.a)("Popup AnnotationStylePopup",this.props),i=n instanceof window.Annotations.StampAnnotation,u=Object(I.c)(n);return t?null:y.a.createElement("div",{className:c,"data-element":"annotationStylePopup",onClick:this.handleClick},y.a.createElement(R.a,{colorMapKey:u,style:a,isFreeText:r,isSignature:s,annotation:n,onStyleChange:this.debounceHandleStyleChange,hideDivider:i,isAnnotationStylePopup:!0,placement:o}))}}]),n}(y.a.Component);D.propTypes=A,D.defaultProps={isDisabled:!1,placement:"bottom"};var k=D,T={closeElement:a.a.closeElement};t.a=Object(r.c)((function(e){return{isDisabled:o.a.isElementDisabled(e,"annotationStylePopup")}}),T)(k)},"./src/lumin-components/CommentPanel/index.js":function(e,t,n){"use strict";n.r(t);var a=n("./node_modules/@babel/runtime/helpers/defineProperty.js"),o=n.n(a),r=n("./node_modules/@babel/runtime/helpers/slicedToArray.js"),s=n.n(r),c=n("./node_modules/lodash/debounce.js"),i=n.n(c),u=n("./node_modules/react/index.js"),l=n.n(u),d=n("./node_modules/classnames/index.js"),m=n.n(d),f=n("./node_modules/react-redux/es/index.js"),p=n("./node_modules/prop-types/index.js"),v=n.n(p),b=n("./src/lumin-components/NoteLumin/index.js"),g=n("./src/lumin-components/NoteCommentBox/CommentContext.js"),h=n("./src/redux/selectors/index.js"),j={annotation:v.a.object.isRequired,handleResize:v.a.func.isRequired},E=function(e){var t=e.annotation,n=e.handleResize,a=Object(u.useContext)(g.a).isSelected,o=Object(f.f)((function(e){return h.a.getCommentPos(e,t.Id)})),r=Object(u.useRef)(),s=Object(u.useRef)();function c(e){e.forEach((function(e){e.contentBoxSize&&n()}))}Object(u.useEffect)((function(){return r.current=new ResizeObserver(c),r.current.observe(s.current),function(){r.current.disconnect()}}),[]);var i={zIndex:a?50:49,top:o,visibility:t.getContents()||o?"":"hidden"},d=m()({NoteCommentBox:!0,"with-transition":t.getContents()});return l.a.createElement("div",{ref:s,className:d,id:t.Id,style:i},l.a.createElement(b.a,{annotation:t,isCommentPanel:!0,isRightPanel:!1}))};E.propTypes=j;var y=E,O=n("./src/constants/commentState.js"),C=n("./src/constants/documentConstants.js"),w=n("./src/constants/customDataConstant.js"),S=n("./src/helpers/device.js"),R=n("./src/helpers/scrollToAnnotation.js"),N=n("./src/hooks/index.js"),x=n("./src/redux/actions/index.js"),P=n("./src/core/index.js");function I(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,a)}return n}function _(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?I(Object(n),!0).forEach((function(t){o()(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):I(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var A="allow-self-scroll";var D=function(e){var t,n,a=P.default.getDocument().getPageRotation(e.PageNumber),o=P.default.getPageInfo(e.PageNumber),r=o.height,s=o.width,c=0;switch(a){case 90:t=e.X,n=s-e.Y;break;case 180:t=r-e.Y,n=s-e.X;break;case 270:t=r-e.X,n=e.Y;break;default:t=e.Y,n=e.X}for(var i=1;i<e.PageNumber;i++)c+=P.default.getPageInfo(i).height+7.5;return{top:(c+t)*P.default.getZoom(),left:n}},k=function(){var e=Object(f.f)((function(e){return[h.a.isElementOpen(e,"rightPanelComment"),h.a.isElementOpen(e,"searchPanel"),h.a.getLeftPanelWidth(e),h.a.isElementOpen(e,"rightPanel"),h.a.getIsShowTopBar(e),h.a.isElementOpen(e,"leftPanel"),h.a.getDisplayMode(e),h.a.getAnnotationsLoaded(e),h.a.getIdealPlacement(e),h.a.isPageEditMode(e),h.a.getIsShowBannerAds(e)]}),f.d),t=s()(e,11),n=t[0],a=t[1],o=t[2],r=t[3],c=t[4],d=t[5],p=t[6],v=t[7],b=t[8],j=t[9],E=t[10],I=Object(f.e)(),k=Object(u.useState)({right:0}),T=s()(k,2),M=T[0],L=T[1],F=Object(u.useState)([]),H=s()(F,2),B=H[0],q=H[1],G=Object(u.useState)({}),z=s()(G,2),U=z[0],V=z[1],K=Object(u.useState)([]),Y=s()(K,2),W=Y[0],X=Y[1],J=Object(u.useState)({}),Z=s()(J,2),$=Z[0],Q=Z[1],ee=Object(u.useState)(""),te=s()(ee,1)[0],ne=Object(u.useState)(!1),ae=s()(ne,2),oe=ae[0],re=ae[1],se=Object(N.o)(500),ce=Object(u.useRef)(),ie=Object(u.useRef)(),ue=Object(u.useRef)(),le=Object(u.useRef)(i()((function(){Ee()}),500)).current,de=P.default.getDisplayMode()===P.default.CoreControls.DisplayModes.Continuous,me=P.default.getTool("AnnotationCreateSticky");Object(u.useEffect)((function(){return ye(),ve(),Ee(),P.default.addEventListener("annotationChanged",he),document.addEventListener("mousemove",fe),me.addEventListener("annotationCreated",be),function(){P.default.removeEventListener("annotationSelected",ge),document.removeEventListener("mousemove",fe),P.default.removeEventListener("annotationChanged",he),me.removeEventListener("annotationCreated",be)}}),[]),Object(u.useEffect)((function(){n&&Object(S.p)()&&I(x.a.closeElement("searchPanel"))}),[I,n]),Object(u.useEffect)((function(){var e=i()((function(){ye(),pe(),Ee(),Oe()}),300);return P.default.docViewer.addEventListener("pageComplete",e),P.default.addEventListener("annotationSelected",ge),function(){P.default.docViewer.removeEventListener("pageComplete",e),P.default.removeEventListener("annotationSelected",ge)}}),[b,j,p]),Object(u.useEffect)((function(){var e=ce.current.hasChildNodes();r||n||!e||I(x.a.openElement("rightPanelComment")),!r&&Object.keys($).length&&I(x.a.closeElements(["searchPanel","searchOverlay","leftPanel"]))}),[r,n,$]),Object(u.useEffect)((function(){B.length&&Ee()}),[B]),Object(u.useEffect)((function(){v&&(pe(),Ee(),ye())}),[v,se]),Object(u.useEffect)((function(){j?P.default.getViewerElement().style.minHeight="":pe()}),[b,j]),Object(u.useEffect)((function(){de||(P.default.getViewerElement().style.minHeight="",W.length&&(P.default.getAnnotationManager().deselectAnnotations(W),V({})))}),[p,W]),Object(u.useEffect)((function(){Object.keys($).length&&(ue.current&&Object(R.a)(ce.current,$,"instant"),I(x.a.setSelectedComment($.Id)))}),[$]);var fe=function(e){var t=e.target;ce.current.contains(t)?Ce():we()},pe=function(){if(Object.keys(b).length&&de&&!j){var e=function(){for(var e=0,t=1;t<=P.default.getTotalPages();t++)e+=document.getElementById("pageContainer".concat(t)).offsetHeight;return e}(),t={top:0,height:0};Object.entries(b).forEach((function(e){t.top<e[1].top&&(t.top=e[1].top,t.height=e[1].height)}));var n=t.top+t.height+10;P.default.getViewerElement().style.minHeight=n>e?"".concat(n,"px"):"",ie.current&&(ie.current.style.minHeight="".concat(n>e?n:e,"px"))}},ve=function(){var e=je();q(e)},be=function(e){re(!0),I(x.a.closeElement("rightPanel")),I(x.a.closeElement("leftPanel")),document.body.style.pointerEvents="none","Continuous"!==P.default.getDisplayMode()&&(P.default.setDisplayMode("Continuous"),Object(R.a)(P.default.getScrollViewElement(),e)),I(x.a.setSelectedComment(e.Id))},ge=function(){var e={},t=P.default.getSelectedAnnotations().filter((function(e){return(e.Subject===C.g.COMMENT||e.getCustomData(w.b.IS_HIGHLIGHT_COMMENT.key))&&!e.isReply()}));t.forEach((function(t){e[t.Id]=!0})),re(!0),V(e);var n={},a=t.filter((function(e){return e.Subject===C.g.COMMENT}));a.length>0&&(n=s()(a,1)[0],de||P.default.setDisplayMode(P.default.CoreControls.DisplayModes.Continuous));if(2===t.length){if(t[0].Subject===C.g.HIGHLIGHT&&t[1].Subject===C.g.COMMENT)n=s()(t,2)[1];if(t[0].Subject===C.g.COMMENT&&t[1].Subject===C.g.HIGHLIGHT)n=s()(t,1)[0]}Q(n),X(t)},he=function(e){e.some((function(e){return e instanceof window.Annotations.StickyAnnotation}))&&ve()},je=function(){return P.default.getAnnotationsList().filter((function(e){return e.Subject===C.g.COMMENT&&!e.isReply()&&e.getState()!==O.a.Resolved.state}))},Ee=function(){var e=je(),t={};e.forEach((function(e){if(e.PageNumber<=P.default.getTotalPages()){var n=D(e),a=n.top,o=n.left;t[e.Id]={top:a,left:o}}})),Object.keys(t).length&&I(x.a.setCommentBoxPosition(t))},ye=function(){if(de){var e,t=null===(e=P.default.getViewerElement())||void 0===e?void 0:e.offsetWidth,n=(window.innerWidth-t)/2;L({right:n>=300?"".concat(n-300,"px"):0}),ce.current&&(ce.current.style.paddingTop="".concat(P.default.getViewerElement().getBoundingClientRect().top-P.default.getScrollViewElement().getBoundingClientRect().top+8,"px"))}},Oe=function(){var e=P.default.getScrollViewElement().scrollTop;ce.current&&(ce.current.scrollTop=e)},Ce=function(){ue.current=!0,Se()},we=function(){ue.current=!1,Re()},Se=function(){return ce.current.classList.add(A)},Re=function(){return ce.current.classList.remove(A)},Ne={width:o};return l.a.createElement("div",{className:function(){var e=n&&!j&&de&&!d&&!a,t=!e;return m()({Panel:!0,CommentPanel:!0,open:e,closed:t,"CommentPanel--has-topbar":c,"CommentPanel--has-banner-ads":E})}(),"data-element":"rightPanelComment",style:_(_({},Ne),M)},l.a.createElement("div",{onScroll:function(){var e=ce.current.scrollTop;ce.current.classList.contains(A)&&(P.default.getScrollViewElement().scrollTop=e)},onMouseDown:P.default.deselectAllAnnotations,className:"Panel",id:"panel-scroll",ref:ce},l.a.createElement("div",{className:"normal-notes-container",ref:ie},B.map((function(e){var t={searchInput:te,resize:function(){},isSelected:U[e.Id],isFocusInput:oe,setIsFocusInput:re,isInsideComment:!1,isContentEditable:P.default.canModify(e)&&!e.getContents()};return l.a.createElement(g.a.Provider,{key:"".concat(e.Id),value:t},l.a.createElement(y,{annotation:e,handleResize:le}))})))))};t.default=k},"./src/lumin-components/NoteCommentBox/CommentContext.js":function(e,t,n){"use strict";var a=n("./node_modules/react/index.js"),o=n.n(a).a.createContext();t.a=o},"./src/lumin-components/NoteLumin/Context.js":function(e,t,n){"use strict";var a=n("./node_modules/react/index.js"),o=n.n(a).a.createContext();t.a=o},"./src/lumin-components/NoteLumin/index.js":function(e,t,n){"use strict";var a=n("./node_modules/@babel/runtime/regenerator/index.js"),o=n.n(a),r=n("./node_modules/@babel/runtime/helpers/asyncToGenerator.js"),s=n.n(r),c=n("./node_modules/@babel/runtime/helpers/slicedToArray.js"),i=n.n(c),u=n("./node_modules/react/index.js"),l=n.n(u),d=n("./node_modules/classnames/index.js"),m=n.n(d),f=n("./node_modules/prop-types/index.js"),p=n.n(f),v=n("./node_modules/react-redux/es/index.js"),b=n("./node_modules/@material-ui/core/esm/Button/Button.js"),g=n("./node_modules/@apollo/react-hoc/lib/react-hoc.esm.js"),h=n("./src/redux/store/index.js"),j=n("./src/lumin-components/NoteLumin/Context.js"),E=n("./src/lumin-components/NoteCommentBox/CommentContext.js"),y=n("./node_modules/@babel/runtime/helpers/defineProperty.js"),O=n.n(y),C=n("./node_modules/react-i18next/dist/es/useTranslation.js"),w=n("./node_modules/autolinker/dist/es2015/index.js"),S=n("./node_modules/dayjs/dayjs.min.js"),R=n.n(S),N=n("./node_modules/dayjs/plugin/calendar.js"),x=n.n(N),P=n("./src/constants/lumin-common.js"),I=n("./node_modules/lodash/debounce.js"),_=n.n(I),A=n("./src/redux/selectors/index.js"),D=n("./node_modules/@material-ui/core/esm/MenuList/MenuList.js"),k=n("./node_modules/@material-ui/core/esm/MenuItem/MenuItem.js"),T=n("./src/lumin-components/MaterialPopper/index.js"),M=n("./src/lumin-components/MaterialAvatar/index.js"),L=n("./node_modules/@material-ui/core/esm/TextareaAutosize/TextareaAutosize.js"),F={value:p.a.string,placeholder:p.a.string,onChange:p.a.func.isRequired,onBlur:p.a.func,onFocus:p.a.func,onKeyDown:p.a.func,className:p.a.string,id:p.a.string},H=l.a.forwardRef((function(e,t){var n=e.value,a=void 0===n?"":n,o=e.onChange,r=e.onBlur,s=void 0===r?function(){}:r,c=e.onFocus,i=void 0===c?function(){}:c,d=e.onKeyDown,m=void 0===d?function(){}:d,f=e.placeholder,p=void 0===f?"":f,v=e.className,b=void 0===v?"":v,g=e.id,h=void 0===g?"":g,j=Object(u.useRef)(null);return l.a.createElement(L.a,{className:b,id:h,ref:function(e){j.current=e,t(e)},onBlur:s,onFocus:i,placeholder:p,onChange:o,onKeyDown:m,value:a})}));H.propTypes=F,H.defaultProps={value:"",placeholder:"",onBlur:function(){},onFocus:function(){},onKeyDown:function(){},className:"",id:""};var B=H;function q(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,a)}return n}function G(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?q(Object(n),!0).forEach((function(t){O()(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):q(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var z={value:p.a.string,placeholder:p.a.string,onChange:p.a.func.isRequired,onBlur:p.a.func,onFocus:p.a.func,onSubmit:p.a.func,onKeyDown:p.a.func},U=l.a.forwardRef((function(e,t){var n=G(G({},e),{},{ref:function(e){t(e)},onChange:function(t){e.onChange(t)},onKeyDown:function(t){e.onKeyDown(t),(t.metaKey||t.ctrlKey)&&13===t.which&&e.onSubmit(t)}});return l.a.createElement(B,n)}));U.propTypes=z,U.defaultProps={value:"",placeholder:"",onBlur:function(){},onFocus:function(){},onSubmit:function(){},onKeyDown:function(){}};var V=U,K=n("./src/lumin-components/CircularLoading/index.js"),Y=n("./node_modules/@material-ui/core/esm/Grid/Grid.js"),W=n("./src/utils/index.js"),X=n("./src/services/graphServices/documentGraphServices.js"),J=n("./src/screens/Viewer/Context.js");Z.propTypes={className:p.a.string,currentUser:p.a.object,inputRef:p.a.object,onBlur:p.a.func,onChange:p.a.func,onFocus:p.a.func,onSubmit:p.a.func,placeholder:p.a.string,value:p.a.string,showAvatar:p.a.bool},Z.defaultProps={className:"",currentUser:{},inputRef:{},onBlur:function(){},onChange:function(){},onFocus:function(){},onSubmit:function(){},placeholder:"",value:"",showAvatar:!0};function Z(e){var t=e.className,n=e.placeholder,a=e.value,r=e.onFocus,c=e.onBlur,d=e.onChange,f=e.onSubmit,p=e.inputRef,v=e.currentUser,b=e.showAvatar,g=Object(u.useState)(!1),h=i()(g,2),j=h[0],E=h[1],y=Object(u.useRef)(),O=Object(u.useState)(!1),C=i()(O,2),w=C[0],S=C[1],R=Object(u.useState)(a||""),N=i()(R,2),x=N[0],P=N[1],I=Object(u.useState)(),A=i()(I,2),L=A[0],F=A[1],H=Object(u.useState)([]),B=i()(H,2),q=B[0],G=B[1],z=Object(u.useState)(0),U=i()(z,2),Z=U[0],$=U[1],Q=Object(u.useState)(0),ee=i()(Q,2),te=ee[0],ne=ee[1],ae=Object(u.useContext)(J.a).currentDocument,oe=Boolean(null===v||void 0===v?void 0:v._id),re=Object(u.useCallback)(_()(function(){var e=s()(o.a.mark((function e(t){var n;return o.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!oe||!ae.documentReference||w){e.next=11;break}return S(!0),e.prev=2,e.next=5,X.a.getMentionList({documentId:ae._id,searchKey:t});case 5:n=e.sent,G(n);case 7:return e.prev=7,S(!1),E(!0),e.finish(7);case 11:case"end":return e.stop()}}),e,null,[[2,,7,11]])})));return function(t){return e.apply(this,arguments)}}(),500),[]);Object(u.useEffect)((function(){var e=se(x,Z);"@"===e.charAt(0)?(re(e.slice(1)),ne(Z-e.length)):E(!1)}),[x]),Object(u.useEffect)((function(){a?P(a):($(0),ne(0),P(""))}),[a]),Object(u.useEffect)((function(){function e(){E(!1)}var t=document.getElementById("DocumentContainer");return t.addEventListener("scroll",e),function(){t.removeEventListener("scroll",e)}}),[]);var se=function(e,t){var n=e.substring(0,t).split(/\s+/);return n[n.length-1]};var ce=Object(u.useCallback)((function(){j||c()}),[]);return l.a.createElement("div",{className:"NoteInput__container"},b&&l.a.createElement(M.a,{size:28,src:v?W.d.getAvatar(v.avatarRemoteId):""},v?W.d.getTextAvatar(v.name):""),l.a.createElement("div",{className:"NoteInput",ref:function(e){return F(e)}},l.a.createElement(V,{className:"NoteInput__input",ref:function(e){p.current=e},onKeyDown:function(e){8===e.which&&e.stopPropagation(),32===e.which&&E(!1),(e.metaKey||e.shiftKey)&&50===e.which&&v&&(0!==x.length&&(" "!==x.charAt(Z)&&""!==x.charAt(Z)||" "!==x.charAt(Z-1)&&" "!==x.charAt(Z-2)&&"\n"!==x.charAt(Z-1)&&"\n"!==x.charAt(Z-2))||ne(Z)),j&&(38===e.keyCode&&Z>-1&&(p.current.blur(),y.current.focus()),40===e.keyCode&&Z<q.length-1&&(p.current.blur(),y.current.focus()))},value:x,onChange:function(e){e.preventDefault(),$(e.target.selectionStart),function(){for(var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",t=arguments.length>1?arguments[1]:void 0,n=e.split(""),a=t.split(""),o=0;o<e.length;o++)if(n[o]!==a[o]&&"@"===n[o])return!0;return!1}(x,e.target.value)&&E(!1),P(e.target.value),d&&d(e.target.value)},onBlur:ce,onSubmit:f,placeholder:n,onFocus:r})),j&&Boolean(q.length)&&l.a.createElement(T.a,{open:!0,disablePortal:!0,parentOverflow:"scrollParent",anchorEl:L,placement:"bottom",handleClose:function(){return E(!j)},classes:"NoteInput__popper ".concat(t||"")},l.a.createElement("div",{className:"NoteInput__popper-container"},l.a.createElement(D.a,{className:m()("NoteInput__user-list",{"NoteInput__user-list--disabled":w}),ref:y},q.map((function(e){return l.a.createElement(k.a,{onClick:function(){return function(e){var t="".concat(x.slice(0,te),"@").concat(e.email).concat(x.slice(Z));$(0),P(t),E(!1),p.current.focus(),d(t)}(e)},className:"NoteInput__user-item",key:e._id},l.a.createElement(Y.a,{container:!0,alignItems:"center"},l.a.createElement(Y.a,{item:!0,xs:2},l.a.createElement(M.a,{size:28,src:W.d.getAvatar(e.avatarRemoteId),containerClasses:"comment-avatar"},W.d.getTextAvatar(e.name))),l.a.createElement(Y.a,{item:!0,xs:10,className:"NoteInput__user-item __info"},l.a.createElement("p",null,W.H.getShortStringWithLimit(e.name,30)," ",v&&e.id===v._id?"(You)":""),l.a.createElement("span",null,e.email))))}))),w&&l.a.createElement(K.a,{className:"NoteInput__loading",size:24}))))}var $=Object(v.c)((function(e){return{currentUser:A.a.getCurrentUser(e),currentTeam:A.a.getCurrentTeam(e),currentFolderType:A.a.getCurrentFolderType(e),currentDocument:A.a.getCurrentDocument(e)}}))(Object(g.a)(Z)),Q=n("./src/lumin-components/Icomoon/index.js"),ee=n("./src/lumin-components/AnnotationStylePopup/index.js"),te=n("./src/constants/documentConstants.js"),ne=n("./src/constants/customDataConstant.js"),ae=n("./src/constants/dataElement.js"),oe=n("./src/constants/commentState.js"),re=n("./src/helpers/getAnnotationStyles.js"),se=n("./src/core/index.js"),ce=n("./src/redux/actions/index.js"),ie={annotation:p.a.object.isRequired,setIsEditing:p.a.func.isRequired,handleReopen:p.a.func,setIsShowDeleteOverlay:p.a.func,isResolved:p.a.bool,setIsNotOwnerComment:p.a.func,isCommentPanel:p.a.bool.isRequired},ue=function(e){var t=e.annotation,n=e.setIsEditing,a=e.handleReopen,o=e.setIsShowDeleteOverlay,r=e.isResolved,s=e.setIsNotOwnerComment,c=e.isCommentPanel,d=Object(v.f)((function(e){return[A.a.isElementDisabled(e,"notePopup"),A.a.isElementDisabled(e,"notePopupEdit"),A.a.isElementDisabled(e,"notePopupDelete")]}),v.d),m=i()(d,3),f=m[0],p=m[1],g=m[2],h=Object(u.useState)(se.default.canModify(t)),y=i()(h,2),O=y[0],w=y[1],S=Object(u.useState)(se.default.canModifyContents(t)),R=i()(S,2),N=R[0],x=R[1],P=Object(u.useState)(!1),I=i()(P,2),_=I[0],M=I[1],L=Object(u.useState)(!1),F=i()(L,2),H=F[0],B=F[1],q=Object(v.e)(),G=Object(C.a)(),z=i()(G,1)[0],U=Object(u.useRef)(),V=Object(u.useContext)(c?E.a:j.a),K=V.isInsideComment,Y=void 0!==K&&K,W=V.openCommentPanel,X=void 0===W?function(){}:W,J=V.disabledElements,Z=void 0===J?{}:J,$=V.setIsFocusInput,ie=t instanceof window.Annotations.FreeTextAnnotation,ue=t.isReply(),le=t.getContents(),de=t.Subject===te.g.COMMENT;Object(u.useEffect)((function(){var e=function(){w(se.default.canModify(t)),x(se.default.canModifyContents(t))},n=!p&&se.default.canModify(t),a=!g&&se.default.canModifyContents(t);return s(!(n||a)||f),se.default.addEventListener("updateAnnotationPermission",e),function(){return se.default.removeEventListener("updateAnnotationPermission",e)}}),[t]),Object(u.useEffect)((function(){function e(){M(!1)}var t=document.getElementById("DocumentContainer");return t.addEventListener("scroll",e),function(){t.removeEventListener("scroll",e)}}),[]);return!(!p&&N)&&!(!g&&O)||f?null:l.a.createElement("div",{className:"NotePopup",onClick:function(e){return e.stopPropagation()}},l.a.createElement(b.a,{className:"square overflow  ".concat((_||H)&&"open"),"aria-label":"note",ref:function(e){return U.current=e},onMouseDown:function(){H&&(q(ce.a.enableElement(ae.a.OPACITY_SLIDER)),B(!1)),M(!_)}},l.a.createElement(Q.a,{className:"more-v icon__16"})),l.a.createElement(T.a,{open:_,disablePortal:!0,parentOverflow:"window",anchorEl:U.current,handleClose:function(e){U.current.contains(e.target)||M(!1)},placement:"bottom-end",classes:"NotePopup__popper-comment"},l.a.createElement(D.a,null,!ue&&se.default.getCurrentUser()===t.Author&&!(null!==Z&&void 0!==Z&&Z.annotationStyleEditButton)&&le&&!r&&!t.getCustomData(ne.b.HIGHLIGHT_TEXT.key)&&de&&l.a.createElement(k.a,{onClick:function(){q(ce.a.disableElement(ae.a.OPACITY_SLIDER)),M(!1),B(!0)}},l.a.createElement("span",{className:"icon-color"}),"Change color"),r&&!ue&&l.a.createElement(k.a,{onClick:function(){a(),M(!_)}},l.a.createElement(Q.a,{className:"reopen icon__16"}),"Reopen"),se.default.getCurrentUser()===t.Author&&!r&&l.a.createElement(k.a,{onClick:function(){ie?se.default.getAnnotationManager().trigger("annotationDoubleClicked",t):setTimeout((function(){n(!0),$(!0)}),0),M(!_)}},l.a.createElement(Q.a,{className:"edit icon__16"}),z("action.edit")),l.a.createElement(k.a,{onClick:function(){if(ue){if(se.default.deleteAnnotations([t],{}),t.getState()===oe.a.Cancelled.state){var e=new window.Annotations.StickyAnnotation;e.InReplyTo=t.InReplyTo,e.X=t.X,e.Y=t.Y,e.PageNumber=t.PageNumber,e.Author=t.Author,e.setContents(""),e.setStateModel("Marked"),e.setState(oe.a.Rejected.state),e.DateCreated=t.DateCreated,t.addReply(e),se.default.addAnnotations([e],{})}}else document.querySelector(".reply-container .NoteInput__container textarea").blur(),M(!1),o(!0)}},l.a.createElement(Q.a,{className:"trash icon__16"}),z("action.delete")),Y&&l.a.createElement(k.a,{onClick:function(){M(!1),X()}},l.a.createElement(Q.a,{className:"outlines icon__16"}),"Open Annotation"))),l.a.createElement(T.a,{open:H,disablePortal:!0,parentOverflow:"window",anchorEl:U.current,handleClose:function(e){U.current.contains(e.target)||(q(ce.a.enableElement(ae.a.OPACITY_SLIDER)),B(!1))},placement:"bottom-end",classes:"NotePopup__popper-comment"},H?l.a.createElement("div",{className:"commentColorPalette"},l.a.createElement(ee.a,{placement:"bottom-end",annotation:t,style:Object(re.a)(t),isOpen:H})):l.a.createElement("div",null)))};ue.propTypes=ie,ue.defaultProps={isResolved:!1,handleReopen:function(){},setIsShowDeleteOverlay:function(){},setIsNotOwnerComment:function(){}};var le=ue,de=n("./src/lumin-components/ButtonMaterial/index.js"),me=n("./src/lumin-components/Tooltip/index.js"),fe=n("./src/helpers/MentionsManager.js"),pe=n("./src/constants/map.js"),ve=n("./src/constants/plan.js"),be=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:function(){},t=arguments.length>1?arguments[1]:void 0,n=Object(u.useRef)(!1);Object(u.useEffect)((function(){if(n.current)return e();n.current=!0}),t)};function ge(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,a)}return n}function he(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?ge(Object(n),!0).forEach((function(t){O()(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):ge(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}R.a.extend(x.a);var je={sameDay:"[Today]",lastDay:"[Yesterday]",lastWeek:"[Last] dddd"},Ee={annotation:p.a.object.isRequired,isRightPanel:p.a.bool.isRequired,handleReopen:p.a.func,setIsShowDeleteOverlay:p.a.func,isResolved:p.a.bool,setCommentResolve:p.a.func,openSignInModal:p.a.func,userPlan:p.a.string},ye=function(e){var t,n=e.annotation,a=e.isRightPanel,r=e.handleReopen,c=e.setIsShowDeleteOverlay,d=e.isResolved,f=e.isCommentPanel,p=e.setCommentResolve,g=e.openSignInModal,h=e.userPlan,y=Object(v.f)((function(e){return[A.a.getCurrentUser(e),A.a.getCurrentDocument(e),A.a.getSortStrategy(e),A.a.getNoteDateFormat(e),A.a.getIconColor(e,Object(pe.c)(n)),A.a.getIsNoteEditing(e)]}),v.d),O=i()(y,6),C=O[0],S=O[1],N=O[2],x=O[3],I=O[4],_=O[5],D=Object(u.useContext)(f?E.a:j.a),k=D.isSelected,T=D.searchInput,L=D.resize,F=D.isContentEditable,H=D.isFocusInput,B=D.setIsFocusInput,q=Object(u.useState)(""),G=i()(q,2),z=G[0],U=G[1],V=Object(u.useState)(""),K=i()(V,2),Y=K[0],X=K[1],J=Object(u.useState)(!1),Z=i()(J,2),$=Z[0],ee=Z[1],ae=Object(u.useState)(!1),re=i()(ae,2),ie=re[0],ue=re[1],de=Object(u.useRef)(null),ge=Object(u.useRef)(null),Ee=Object(u.useState)(!0),ye=i()(Ee,2),Oe=ye[0],we=ye[1],Se=Object(u.useState)(!1),Re=i()(Se,2),Ne=Re[0],xe=Re[1],Pe=n.getCustomData(ne.a.MENTION.key),Ie=Object(u.useState)(Pe?null===(t=JSON.parse(Pe))||void 0===t?void 0:t.contents:n.getContents()),_e=i()(Ie,2),Ae=_e[0],De=_e[1],ke=Object(v.e)(),Te=n.isReply(),Me=0===n.getReplies().length,Le=n.Subject===te.g.COMMENT,Fe=n instanceof window.Annotations.StickyAnnotation&&"Marked"===n.getStateModel(),He=!!Le&&n.getState()===oe.a.Cancelled.state,Be=!!Le&&n.getState()===oe.a.Rejected.state,qe=n.getCustomData(ne.b.HIGHLIGHT_TEXT.key),Ge=!0,ze=Object(u.useRef)();be((function(){$||ke(ce.a.finishNoteEditing()),L()}),[$]),Object(u.useEffect)((function(){function e(){return(e=s()(o.a.mark((function e(){var t,a;return o.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Je(n);case 2:return t=e.sent,e.next=5,$e();case 5:a=e.sent,U(t),X(a);case 8:case"end":return e.stop()}}),e)})))).apply(this,arguments)}return ze.current=setTimeout((function(){de.current&&ge.current&&de.current.clientWidth+1<=ge.current.clientWidth&&we(!1)}),0),Ge&&function(){e.apply(this,arguments)}(),se.default.addEventListener("annotationChanged",Ve),se.default.addEventListener("annotationSelected",Ke),function(){Ge=!1,clearTimeout(ze.current),se.default.removeEventListener("annotationChanged",Ve),se.default.removeEventListener("annotationSelected",Ke)}}),[]),Object(u.useEffect)((function(){n instanceof window.Annotations.FreeTextAnnotation&&!Y&&Ue(),_&&k&&F&&ee(!0)}),[F,_,k]),Object(u.useEffect)((function(){k||ue(!1)}),[k]),Object(u.useEffect)((function(){Ue()}),[n]);var Ue=function(){var e=s()(o.a.mark((function e(){var t;return o.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,$e();case 2:t=e.sent,X(t);case 4:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),Ve=function(){var e=s()(o.a.mark((function e(t){return o.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:null!==t&&void 0!==t&&t[0]&&n&&t[0].Id===n.Id&&Ue();case 1:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),Ke=function(e,t){"deselected"===t&&(ee(!1),B(!1),c(!1))},Ye=Object(u.useCallback)((function(e){k&&e.stopPropagation()}),[k]),We=function(){var e=s()(o.a.mark((function e(t){var n,a;return o.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t){e.next=2;break}return e.abrupt("return","");case 2:if(n="string"===typeof t?t:t.Author,!W.M.validateEmail(n)){e.next=9;break}if(!C||n!==C.email){e.next=6;break}return e.abrupt("return",C.name);case 6:if(!(a=fe.a.getUserData()).some((function(e){return e.email===n}))){e.next=9;break}return e.abrupt("return",a.find((function(e){return e.email===n})).name);case 9:return e.abrupt("return",n);case 10:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),Xe=Object(u.useCallback)((function(e){return T.trim()?e.replace(new RegExp("(".concat(T,")"),"gi"),'<span class="highlight">$1</span>'):e.includes("Anonymous")?e.split("-")[0]:e}),[T]),Je=Object(u.useCallback)(function(){var e=s()(o.a.mark((function e(t){var n;return o.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,We(t);case 2:if(n=e.sent){e.next=5;break}return e.abrupt("return",l.a.createElement("span",{className:"author"},"no name"));case 5:return e.abrupt("return",l.a.createElement("span",{className:"author"},n));case 6:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),[Xe]),Ze=function(){var e=s()(o.a.mark((function e(t){var n,a;return o.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=t.split(" "),e.next=3,Promise.all(n.map(function(){var e=s()(o.a.mark((function e(t){var n,a;return o.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=t.split(/\r|\n/),e.next=3,Promise.all(n.map(function(){var e=s()(o.a.mark((function e(t){var n;return o.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!t.startsWith("@")||!W.M.validateEmail(t.slice(1))){e.next=9;break}return e.next=3,We(t.slice(1));case 3:if(n=e.sent){e.next=6;break}return e.abrupt("return",t);case 6:if(-1===n.search("@")){e.next=8;break}return e.abrupt("return",n);case 8:return e.abrupt("return",'<span class="mention">'.concat(n,"</span>"));case 9:return e.abrupt("return",t);case 10:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()));case 3:return a=e.sent,e.abrupt("return",a.join("\n"));case 5:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()));case 3:return a=e.sent,e.abrupt("return",a.join(" "));case 5:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),$e=function(){var e=s()(o.a.mark((function e(){var t,a,r,s,c;return o.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t=n.getContents()){e.next=3;break}return e.abrupt("return",null);case 3:return e.next=5,Ze(t);case 5:return a=e.sent,-1!==w.a.link(a).indexOf("<a")?(r=w.a.link(a,{stripPrefix:!1}),a=r.replace(/>(.+)</i,(function(e,t){return">".concat(Xe(t),"<")}))):a=Xe(a),s=W.h.commentParser(a),c=function(e){var t=e.target.href,n=new URL(t),a=n.hostname.replace("www.",""),o=n.hostname.split(".");"luminpdf.com"!==a&&"luminpdf.com"!=="".concat(o[1],".").concat(o[2])&&(e.preventDefault(),ke(ce.a.openModal({type:P.A.WARNING,title:"You are leaving Lumin PDF",message:"Following this link opens a new browser tab and sends you to a website outside of Lumin PDF",cancelButtonTitle:"Cancel",confirmButtonTitle:"Proceed",onCancel:function(){return ke(ce.a.closeModal())},onConfirm:function(){window.open(n.href,"_blank").focus()},isFullWidthButton:!0})))},e.abrupt("return",l.a.createElement("span",{className:"contents"},s.map((function(e,t){return e.startsWith("<a")?l.a.createElement("span",{key:"".concat(t,"-").concat(n.Id),className:"links",onClick:c,dangerouslySetInnerHTML:{__html:e}}):l.a.createElement("span",{key:"".concat(t,"-").concat(n.Id),dangerouslySetInnerHTML:{__html:e}})}))));case 11:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),Qe=Object(u.useCallback)((function(){var e,t={avatarRemoteId:"",name:""};if(!n)return t;if(e="string"===typeof n?n:n.Author,W.M.validateEmail(e))if(C&&e===C.email)t.avatarRemoteId=C.avatarRemoteId,t.name=C.name;else{var a=fe.a.getUserData();if(a.some((function(t){return t.email===e}))){var o=a.find((function(t){return t.email===e}));t.avatarRemoteId=o.avatarRemoteId,t.name=o.name}}return t}),[]),et=Object(u.useCallback)((function(){var e=Object(pe.b)(Object(pe.c)(n)).icon,t="Signature"!==n.Subject?I&&n[I].toHexString():null;if(e){var a="annotation-redact"===e?"basic-redaction":e;return"comment"===a?l.a.createElement(M.a,{size:28,src:W.d.getAvatar(Qe().avatarRemoteId)},W.d.getTextAvatar(Qe().name)):l.a.createElement(Q.a,{className:a,color:t,size:22})}return n.Subject}),[]),tt=function(){k&&ue(!ie)},nt=function(){h===ve.c.NO_PLAN?g():p(!0)},at=Object(u.useMemo)((function(){var e;if(Te)e=l.a.createElement(l.a.Fragment,null,l.a.createElement("div",{className:"title"},l.a.createElement("div",{className:"type"},l.a.createElement(M.a,{size:28,src:W.d.getAvatar(Qe().avatarRemoteId)},W.d.getTextAvatar(Qe().name))),l.a.createElement("div",{className:"info-wrapper"},z,l.a.createElement("span",{className:"time"},"\n                ".concat(R()(n.DateCreated).calendar(null,he(he({},je),{},{sameElse:x.split(",")[0]})),",\n                ").concat(R()(n.DateCreated).format(x.split(",")[1]),"\n              "))),k&&!d&&!Fe&&!Be&&l.a.createElement(le,{isCommentPanel:f,annotation:n,setIsEditing:ee})));else{var t=n.getReplies().filter((function(e){return"Marked"!==e.getStateModel()&&e.getState()!==oe.a.Rejected.state})).length;e=l.a.createElement("div",{className:m()("title",{comment_added:Le&&!Y})},l.a.createElement("div",{className:"type"},et()),l.a.createElement("div",{className:"user-info"},z,l.a.createElement("div",{className:"time"},("time"!==N||k)&&R()(n.DateCreated||new Date).calendar(null,he(he({},je),{},{sameElse:x.split(",")[0]})),","," ",R()(n.DateCreated).format(x.split(",")[1]),t>0&&l.a.createElement("span",{className:"reply-count"},l.a.createElement(Q.a,{className:"reply-count",size:16}),t))),Le&&Y&&!d&&l.a.createElement("div",{className:"check-resolved"},l.a.createElement(me.a,{content:"Mark as resolved",additionalClass:"note_tooltip_edit ".concat(Ne?"note_tooltip_edit-left":"")},l.a.createElement(b.a,{className:"Resolved__btn",onClick:nt},l.a.createElement(Q.a,{className:"check icon__16 icon"})))),l.a.createElement(le,{isResolved:d,isCommentPanel:f,handleReopen:r,setIsShowDeleteOverlay:c,annotation:n,setIsEditing:ee,setIsNotOwnerComment:xe}))}return e}),[k,z,Y]);return Object(u.useMemo)((function(){return l.a.createElement("div",{className:m()("NoteContent",{"no-content":!Y&&!Be,"no-reply":Me&&!Te,"is-status":Fe}),onMouseDown:function(e){return e.preventDefault()}},l.a.createElement("div",{className:"NoteContent__right"},at,qe&&a&&l.a.createElement("div",{className:"highlight ".concat(!Le||Y||Be?"":"comment_added"),onMouseDown:tt},l.a.createElement("div",{className:"highlight__mark_left"},l.a.createElement("div",null)),l.a.createElement("div",{ref:ge,className:"highlight__text ".concat(ie?"opened":"closed")},l.a.createElement("span",{ref:de},qe),Oe&&l.a.createElement("div",{className:"icon"},l.a.createElement(Q.a,{className:ie?"light-arrow-up":"light-arrow-down",size:16})))),l.a.createElement("div",{className:"content-container ".concat(!Le||Y||Be?"":"comment_added"),onMouseDown:Ye},$&&H?l.a.createElement(Ce,{textAreaValue:Ae,onTextAreaValueChange:De,annotation:n,setIsEditing:ee,currentUser:C,currentDocument:S,setContent:X,setIsFocusInput:B}):l.a.createElement("div",{className:"content-container"},He&&l.a.createElement("p",{className:"reopened"},oe.a.Cancelled.message),Be&&l.a.createElement("p",{className:"reopened"},oe.a.Rejected.message),l.a.createElement("p",{className:"container"},Y)))),l.a.createElement("hr",null))}),[Ye,$,$e])};ye.propTypes=Ee,ye.defaultProps={setIsShowDeleteOverlay:function(){},isResolved:!1,isCommentPanel:!1,setCommentResolve:function(){},openSignInModal:function(){},userPlan:"",isRightPanel:!1};var Oe=Object(g.a)(ye),Ce=function(e){var t,n=e.annotation,a=e.setIsEditing,r=e.currentUser,c=e.currentDocument,d=e.setContent,f=e.setIsFocusInput,p=n.getCustomData(ne.a.MENTION.key),v=p?null===(t=JSON.parse(p))||void 0===t?void 0:t.contents:n.getContents(),b=Object(u.useState)(v),g=i()(b,2),h=g[0],j=g[1],E=Object(u.useState)([]),y=i()(E,2),O=y[0],w=y[1],S=Object(C.a)(),R=i()(S,1)[0],N=Object(u.useRef)(),x=n.getCustomData(ne.b.HIGHLIGHT_TEXT.key),P=Object(u.useRef)(!1);Object(u.useEffect)((function(){return setTimeout((function(){if(N.current){N.current.focus();var e=N.current.value.length;N.current.setSelectionRange(e,e)}}),300),function(){clearTimeout(N.current)}}),[]),Object(u.useEffect)((function(){if(h){var e=h.trim(),t=W.h.getEmailsFromContent(r,e);w(t)}}),[]),Object(u.useEffect)((function(){return se.default.addEventListener("annotationSelected",I),function(){se.default.removeEventListener("annotationSelected",I)}}),[h]);var I=function(e,t){"deselected"!==t||P.current||n.Subject===te.g.COMMENT&&(n.getContents()||(h?k(window.event,!1):_()))},_=function(){var e=se.default.getAnnotationsList().filter((function(e){return e.Subject===te.g.HIGHLIGHT&&e.getCustomData(ne.b.IS_HIGHLIGHT_COMMENT.key)})).find((function(e){return e.getCustomData(ne.b.STICKY_ID.key)===n.Id}));e&&se.default.deleteAnnotations([e]),se.default.deleteAnnotations([n])},A=function(e){return{ownerEmail:e.Author,ownerComment:e.getContents(),comments:e.getReplies().map((function(e){return{email:e.Author,content:e.getContents()}}))}},D=function(){var e=s()(o.a.mark((function e(t){var s,i,u,l,m,p,b,g;return o.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:t.preventDefault(),h!==v&&h.trim()&&(a(!1),f(!1),s=h.trim(),i=W.h.getEmailsFromContent(r,s),u=W.h.getNewTagUsers(O,i),s&&(l=c._id,m=c.ownerId,r?(p=r.name,b={name:p,id:r._id},(0===u.length||u.every((function(e){return e!==n.Author})))&&r._id!==m&&W.G.socketEmitSendEmailComment(b,l,new Date,s),0!==u.length&&(g=A(n),W.G.socketEmitSendEmailMention(b,l,s,g,u))):W.G.socketEmitSendEmailComment({name:"Anonymous"},l,new Date,s),d(W.h.clearAllMarkupSymbol(s)),se.default.setNoteContents(n,W.h.clearAllMarkupSymbol(s)),n instanceof window.Annotations.FreeTextAnnotation&&se.default.drawAnnotationsFromList([n])));case 3:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),k=function(e){var t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];if(e.preventDefault(),e.stopPropagation(),P.current=!0,x){var o=se.default.getAnnotationsList().find((function(e){return e.getCustomData(ne.b.STICKY_ID.key)===n.Id}));v?o.DateModified=n.DateModified:o.setCustomData(ne.b.HIGHLIGHT_HAS_CONTENT.key,ne.b.HIGHLIGHT_HAS_CONTENT.hasValue)}h&&h.trim()&&(D(e),a(!1),f(!1)),t&&!v&&se.default.deselectAnnotation(n)};return l.a.createElement("div",{className:"edit-content"},l.a.createElement($,{inputRef:N,value:W.h.redoMarkupSymbol(h),onChange:j,closeEditing:function(){a(!1),f(!1)},placeholder:"".concat(R("action.comment"),"..."),onSubmit:D,showAvatar:!v}),l.a.createElement("span",{className:"buttons"},l.a.createElement(de.a,{className:"secondary",onMouseDown:function(){a(!1),f(!1),v||"Comment"!==n.Subject||se.default.deleteAnnotations([n],{})}},R("action.cancel")),l.a.createElement(de.a,{className:m()("primary",{disabled:!(h&&h.trim())}),disabled:!(h&&h.trim()),onMouseDown:k},v?"Save":"Comment")))};Ce.propTypes={annotation:p.a.object.isRequired,setIsEditing:p.a.func.isRequired,currentUser:p.a.object,currentDocument:p.a.object,setContent:p.a.func,setIsFocusInput:p.a.func},Ce.defaultProps={currentUser:{},currentDocument:{},setContent:function(){},setIsFocusInput:function(){}};var we=Oe;function Se(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,a)}return n}function Re(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?Se(Object(n),!0).forEach((function(t){O()(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):Se(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var Ne=function(e){var t=e.annotation,n=e.handleReplyReopen,a=e.replyTextareaRef,o=e.isResolved,r=e.changeIsReOpenByReply,s=e.isCommentPanel,c=Object(v.f)((function(e){var n;return[A.a.getCurrentUser(e),A.a.getCurrentDocument(e),A.a.isDocumentReadOnly(e),A.a.isElementDisabled(e,"noteReply"),null===(n=A.a.getIsReplyDisabled(e))||void 0===n?void 0:n(t),A.a.getIsNoteEditing(e)]}),v.d),d=i()(c,6),f=d[0],p=d[1],b=d[2],g=d[3],h=d[4],y=d[5],O=Object(u.useContext)(s?E.a:j.a),w=O.resize,S=O.isContentEditable,R=O.isSelected,N=Object(u.useState)(!1),x=i()(N,2),P=x[0],I=x[1],_=Object(u.useState)(""),D=i()(_,2),k=D[0],T=D[1],M=Object(C.a)(),L=i()(M,1)[0],F=Object(v.e)(),H={email:t.Author,content:t.getContents()},B=t.getReplies().map((function(e){return{email:e.Author,content:e.getContents()}})).concat([H]);be((function(){P||F(ce.a.finishNoteEditing()),w()}),[P]),Object(u.useEffect)((function(){y&&R&&!S&&a&&a.current.focus()}),[S,y,R]);var q=function(e){e.preventDefault();var a=Re(Re({},H),{},{comments:B}),c=k&&k.trim();if(c){o&&r(!0),se.default.createAnnotationReply(t,W.h.clearAllMarkupSymbol(k.trim()));var i=p._id,u=t.Author,l=W.h.getEmailsFromContent(f,k.trim()),d=Array.from(new Set(B.filter((function(e){return(null===f||void 0===f?void 0:f.email)!==e.email})).map((function(e){return e.email}))));if(f){var m={name:f.name,id:f._id};if(l.length>0&&W.G.socketEmitSendEmailMention(m,i,k.trim(),a,l),l.every((function(e){return e!==u}))&&B.length>0){var v=d.filter((function(e){return!l.find((function(t){return t===e}))}));W.G.socketEmitSendEmailReply(m,i,u,v,a,c)}}else W.G.socketEmitSendEmailReply({name:"Anonymous"},i,u,d,a,c)}T(""),n(),s&&se.default.deselectAnnotation(t)},G=m()({disabled:!k||!k.trim()});return b||g||h||y&&S?null:l.a.createElement("div",{className:"reply-container",onMouseDown:function(e){return e.stopPropagation()}},l.a.createElement("hr",null),l.a.createElement($,{inputRef:a,value:k,onChange:function(e){return T(e)},onFocus:function(){return I(!0)},placeholder:o?"Adding a comment will reopen this discussion":L("action.reply"),onBlur:function(){return I(!1)},onSubmit:q}),P&&l.a.createElement("div",{className:"buttons btn_mg-0"},l.a.createElement(de.a,{className:"secondary",onMouseDown:function(){T(""),a.current.blur()}},L("action.cancel")),l.a.createElement(de.a,{className:"primary ".concat(G),onMouseDown:q,disabled:!k||!k.trim()},"Reply")))};Ne.propTypes={annotation:p.a.object.isRequired,handleReplyReopen:p.a.func,replyTextareaRef:p.a.object,isResolved:p.a.bool.isRequired,changeIsReOpenByReply:p.a.func,isCommentPanel:p.a.bool},Ne.defaultProps={handleReplyReopen:function(){},replyTextareaRef:{},changeIsReOpenByReply:function(){},isCommentPanel:!1};var xe=Ne,Pe=(n("./src/lumin-components/CustomCheckbox/index.js"),n("./src/constants/socketConstant.js")),Ie=n("./src/helpers/setToolModeAndGroup.js"),_e=n("./src/helpers/scrollToAnnotation.js"),Ae=n("./src/socket/index.js"),De={annotation:p.a.object.isRequired,isCommentPanel:p.a.bool.isRequired,isRightPanel:p.a.bool.isRequired},ke=0,Te=function(e){var t=e.annotation,n=e.isCommentPanel,a=e.isRightPanel,r=Object(u.useContext)(n?E.a:j.a),c=r.isSelected,d=r.resize,f=Object(u.useRef)(),p=Object(u.useRef)(),b=Object(u.useRef)(null),g=t instanceof window.Annotations.StickyAnnotation,y=Object(u.useRef)([]),O=Object(u.useState)(!1),C=i()(O,2),w=C[0],S=C[1],R=se.default.getAnnotationManager(),N=Object(v.f)((function(e){return[A.a.getNoteTransformFunction(e),A.a.getCurrentDocument(e),A.a.getCurrentUser(e)]}),v.d),x=i()(N,3),P=x[0],I=x[1],_=x[2],D=Object(v.e)(),k=t.getContents(),T=_?"":ve.c.NO_PLAN,M=g&&t.getState()===oe.a.Resolved.state,L=Object(u.useRef)(!1),F=se.default.getAnnotationsList().find((function(e){return e.getCustomData(ne.b.STICKY_ID.key)===t.Id}));Object(u.useEffect)((function(){return se.default.addEventListener("addReply",H),function(){return se.default.removeEventListener("addReply",H)}}),[]),Object(u.useEffect)((function(){var e=p.current,t=f.current.getBoundingClientRect().height;p.current=t,e&&Math.round(e)!==Math.round(t)&&d()}),[c,d]),Object(u.useEffect)((function(){if(P){y.current.forEach((function(e){var t=document.querySelector("[data-webviewer-custom-element='".concat(e,"']"));t&&t.parentNode.removeChild(t)})),y.current=[];var e={annotation:t,isSelected:c};P(f.current,e,(function(){var e,t=(e=document).createElement.apply(e,arguments),n="custom-element-".concat(ke);return ke++,y.current.push(n),t.setAttribute("data-webviewer-custom-element",n),t.addEventListener("mousedown",(function(e){e.stopPropagation()})),t}))}})),Object(u.useEffect)((function(){F&&Fe(M,F)}),[M]);var H=function(e,t,n){L.current&&"Marked"!==e.getStateModel()&&"Comment"===n.Subject&&(e.setState(oe.a.Cancelled.state),L.current=!1)},B=function(){var e=s()(o.a.mark((function e(n){var a;return o.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n&&n.stopPropagation(),(null===(a=se.default.getToolMode())||void 0===a?void 0:a.name)!==window.Tools.ToolNames.FREEHAND){e.next=4;break}return e.next=4,Object(Ie.a)(h.a,"AnnotationEdit");case 4:c||(se.default.deselectAllAnnotations(),se.default.selectAnnotation(t),t.isVisible()&&Object(_e.a)(se.default.getScrollViewElement(),t),F&&(se.default.selectAnnotation(F),F.isVisible()&&Object(_e.a)(se.default.getScrollViewElement(),F)));case 5:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),q=function(){var e=s()(o.a.mark((function e(n){var a,r=arguments;return o.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(a=r.length>1&&void 0!==r[1]?r[1]:"button",n===M){e.next=4;break}return e.next=4,Be(n,t,F,I,_);case 4:n?R.updateAnnotationState(t,oe.a.Resolved.state,"Marked",oe.a.Resolved.message):M&&"button"===a&&R.updateAnnotationState(t,oe.a.Open.state,"Marked",oe.a.Open.message);case 5:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),G=m()({NoteLumin:!0,expanded:c,resolved:M}),z=m()({replies:!0,hidden:!c}),U=t.getReplies().sort((function(e,t){return e.DateCreated-t.DateCreated})),V=function(){D(ce.a.openElement("signInUseCommentModal"))};return l.a.createElement("div",{className:G,ref:f,onMouseDown:B},g&&k&&M&&l.a.createElement("div",{className:"NoteLumin_header"},l.a.createElement(Le,{setCommentResolve:q,userPlan:T,openSignInModal:V})),l.a.createElement("div",{className:"NoteLumin__wrapper-note-content",role:"button",tabIndex:0},l.a.createElement(we,{handleReopen:function(){return q(!1)},setIsShowDeleteOverlay:function(e){b.current&&b.current.blur(),S(e)},annotation:t,isResolved:M,isRightPanel:a,isCommentPanel:n,setCommentResolve:q,openSignInModal:V,userPlan:T}),l.a.createElement("div",{className:z},U.map((function(e){return l.a.createElement(we,{key:e.Id,isResolved:M,annotation:e,isCommentPanel:n,isRightPanel:a})})),T!==ve.c.NO_PLAN?l.a.createElement(xe,{replyTextareaRef:b,annotation:t,handleReplyReopen:function(){return q(!1,"reply")},isResolved:M,changeIsReOpenByReply:function(e){return L.current=e},isCommentPanel:n,isRightPanel:a}):l.a.createElement("div",null)),w&&l.a.createElement(Me,{setIsShowDeleteOverlay:S,handleDelete:function(){se.default.deleteAnnotations([t],{}),F&&se.default.deleteAnnotations([F],{})}})))},Me=function(e){var t=e.setIsShowDeleteOverlay,n=e.handleDelete;return l.a.createElement(l.a.Fragment,null,l.a.createElement("div",{className:"note_delete_mask"}),l.a.createElement("div",{className:"note_delete_content"},l.a.createElement("div",{className:"note_delete_content_title"},"Delete this comment thread?"),l.a.createElement("div",{className:"note_delete_content_button_group"},l.a.createElement(de.a,{className:"secondary",onClick:function(){return t(!1)}},"Cancel"),l.a.createElement(de.a,{className:"primary",onClick:n},"Delete"))))};Me.propTypes={setIsShowDeleteOverlay:p.a.func.isRequired,handleDelete:p.a.func.isRequired};p.a.string.isRequired,p.a.func.isRequired,p.a.bool.isRequired,p.a.string.isRequired,p.a.func.isRequired,p.a.object.isRequired;var Le=function(e){var t=e.setCommentResolve,n=e.userPlan,a=e.openSignInModal;return l.a.createElement("div",{className:"note-resolved-wrapper"},l.a.createElement("div",{className:"label"},l.a.createElement(Q.a,{className:"check",size:14}),l.a.createElement("span",null,"Resolved")),l.a.createElement(b.a,{className:m()({action:!0,disabled:n===ve.c.NO_PLAN}),onClick:function(){n!==ve.c.NO_PLAN?t(!1):a()}},"Reopen"))};Le.propTypes={setCommentResolve:p.a.func.isRequired,userPlan:p.a.string.isRequired,openSignInModal:p.a.func.isRequired};var Fe=function(e,t){var n=se.default.getAnnotationManager();e?n.hideAnnotation(t):n.showAnnotation(t)},He=function(e,t,n,a){Ae.a.emit(Pe.a.ANNOTATION_CHANGE,{roomId:n._id,xfdf:t,annotationId:e,userId:a._id,email:a.email})},Be=function(){var e=s()(o.a.mark((function e(t,n,a,r,c){return o.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",new Promise(function(){var e=s()(o.a.mark((function e(s){var u,l,d,m,f,p,v,b,g,h,j;return o.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return u=se.default.getAnnotationManager(),e.next=3,Ge(a?[n,a]:[n]);case 3:l=e.sent,d=i()(l,2),m=d[0],f=d[1],p=new XMLSerializer,v="",m.setAttribute("state",t?oe.a.Resolved.state:oe.a.Open.state),a?(g=f.getAttribute("flags").split(","),t?g.push("hidden"):g.indexOf("hidden")>-1&&g.splice(g.indexOf("hidden"),1),f.setAttribute("flags",g.join(",")),v=p.serializeToString(f)):(b=m.getAttribute("flags").split(","),t?b.push("noview"):b.indexOf("noview")>-1&&b.splice(b.indexOf("noview"),1),m.setAttribute("flags",b.join(","))),h=p.serializeToString(m),j=qe(h+v),He(n.Id,j,r,c),u.importAnnotCommand(j),t&&se.default.deselectAnnotation(n),t||(Object(_e.a)(se.default.getScrollViewElement(),n,"instant"),se.default.selectAnnotation(n)),s();case 18:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()));case 1:case"end":return e.stop()}}),e)})));return function(t,n,a,o,r){return e.apply(this,arguments)}}(),qe=function(e){return'<?xml version="1.0" encoding="UTF-8" ?>\n<xfdf xmlns="http://www.w3.org/1999/xhtml" xml:space="preserve"><fields /><add /><modify>'.concat(e,"</modify><delete /></xfdf>")},Ge=function(){var e=s()(o.a.mark((function e(t){return o.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",new Promise(function(){var e=s()(o.a.mark((function e(n){var a,r;return o.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a=new DOMParser,e.next=3,se.default.getAnnotationManager().exportAnnotations({annotList:t,widgets:!1,links:!1,fields:!1});case 3:r=e.sent,n(a.parseFromString(r,"text/xml").querySelector("annots").children);case 5:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()));case 1:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}();Te.propTypes=De,Te.defaultProps={};var ze=Object(g.a)(Te);t.a=ze}}]);