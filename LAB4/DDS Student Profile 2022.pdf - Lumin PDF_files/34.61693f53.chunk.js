(window.webpackJsonp=window.webpackJsonp||[]).push([[34],{"./src/lumin-components/StampOverlay/index.js":function(e,t,n){"use strict";n.r(t);var a=n("./node_modules/react-redux/es/index.js"),o=n("./node_modules/react-i18next/dist/es/withTranslation.js"),s=n("./node_modules/react-onclickoutside/dist/react-onclickoutside.es.js"),r=n("./src/redux/actions/index.js"),l=n("./src/redux/selectors/index.js"),i=n("./node_modules/@babel/runtime/regenerator/index.js"),u=n.n(i),c=n("./node_modules/@babel/runtime/helpers/asyncToGenerator.js"),d=n.n(c),m=n("./node_modules/@babel/runtime/helpers/classCallCheck.js"),p=n.n(m),f=n("./node_modules/@babel/runtime/helpers/createClass.js"),v=n.n(f),b=n("./node_modules/@babel/runtime/helpers/assertThisInitialized.js"),h=n.n(b),g=n("./node_modules/@babel/runtime/helpers/inherits.js"),y=n.n(g),S=n("./node_modules/@babel/runtime/helpers/possibleConstructorReturn.js"),j=n.n(S),E=n("./node_modules/@babel/runtime/helpers/getPrototypeOf.js"),O=n.n(E),R=n("./node_modules/@babel/runtime/helpers/defineProperty.js"),T=n.n(R),w=n("./node_modules/react/index.js"),x=n.n(w),_=n("./node_modules/prop-types/index.js"),k=n.n(_),A=n("./node_modules/classnames/index.js"),N=n.n(A),q=n("./src/core/index.js"),C=n("./src/constants/defaultTool.js");function D(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,a=O()(e);if(t){var o=O()(this).constructor;n=Reflect.construct(a,arguments,o)}else n=a.apply(this,arguments);return j()(this,n)}}var P="AnnotationCreateRubberStamp",B=function(e){y()(n,e);var t=D(n);function n(e){var a;return p()(this,n),a=t.call(this,e),T()(h()(a),"handleClickOutside",(function(e){var t=document.querySelector('[data-element="toolStylePopup"]'),n=document.querySelector('[data-element="toolsOverlay"]'),o=null===n||void 0===n?void 0:n.contains(e.target),s=document.querySelector('[data-element="header"]'),r=null===t||void 0===t?void 0:t.contains(e.target),l=null===s||void 0===s?void 0:s.contains(e.target),i=e.target.getAttribute("data-element")===a.props.dataElement;a.props.isActive&&a.props.toggleElement("stampOverlay"),i||(a.props.closeElement("stampOverlay"),a.props.activeToolName!==P||r||l||o||a.state.isStampSelected||q.default.setToolMode(C.a))})),T()(h()(a),"setOverlayPosition",(function(){var e=document.querySelector('[data-element="'.concat(a.props.dataElement,'"]'));if(e&&a.overlay.current){var t=function(e,t){var n=e.getBoundingClientRect(),a=t.current.getBoundingClientRect(),o=(n.left+n.right)/2,s=n.bottom+1,r=o-a.width/2;return{left:r=(r=o+a.width/2>window.innerWidth?window.innerWidth-a.width-12:r)<0?0:r,top:s}}(e,a.overlay);a.setState(t)}})),T()(h()(a),"getDefaultRubberStamps",function(){var e=d()(u.a.mark((function e(t){var n,o,s;return u.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(a.state.defaultAnnotations.length&&!t){e.next=7;break}return n=a.stampTool.getDefaultStampAnnotations(),e.next=4,Promise.all(n.map((function(e){var t={canvasWidth:160,canvasHeight:58,text:a.props.t("rubberStamp.".concat(e.Icon))};return a.stampTool.getPreview(e,t)})));case 4:o=e.sent,s=n.map((function(e,t){return{annotation:e,imgSrc:o[t]}})),a.setState({defaultAnnotations:s,language:a.props.i18n.language});case 7:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()),a.overlay=x.a.createRef(),a.state={left:0,right:"auto",top:0,defaultAnnotations:[],language:e.i18n.language,isStampSelected:!1},a.stampTool=q.default.getTool(P),a}return v()(n,[{key:"componentDidUpdate",value:function(e){var t=this.state.language&&this.props.i18n.language!==this.state.language;e.activeToolName!==this.props.activeToolName&&this.props.activeToolName===P?(this.setState({isStampSelected:!1}),this.props.openElement("stampOverlay"),this.setOverlayPosition(),this.getDefaultRubberStamps(t)):this.props.isOpen&&t&&this.getDefaultRubberStamps(t)}},{key:"setRubberStamp",value:function(e){q.default.setToolMode(P),this.props.closeElement("stampOverlay");var t=this.props.t("rubberStamp.".concat(e.Icon));this.stampTool.setRubberStamp(e,t),this.stampTool.showPreview(),this.setState({isStampSelected:!0})}},{key:"render",value:function(){var e=this,t=this.state,n=t.left,a=t.top,o=t.defaultAnnotations,s=this.props,r=s.isDisabled,l=s.isOpen;if(r)return null;var i=null;l&&(i=o.map((function(t,n){var a=t.imgSrc,o=t.annotation;return x.a.createElement("div",{key:n,className:"rubber-stamp",onClick:function(){return e.setRubberStamp(o)}},x.a.createElement("img",{src:a}))})));var u=N()({Overlay:!0,StampOverlay:!0,open:l,closed:!l});return x.a.createElement("div",{className:u,ref:this.overlay,style:{left:n,top:a},"data-element":"stampOverlay"},x.a.createElement("div",{className:"default-stamp-container"},x.a.createElement("div",{className:"modal-body"},i)))}}]),n}(x.a.Component);T()(B,"propTypes",{activeToolName:k.a.string,isDisabled:k.a.bool,isOpen:k.a.bool,isActive:k.a.bool,t:k.a.func.isRequired,i18n:k.a.any,toolButtonObjects:k.a.object.isRequired,openElement:k.a.func.isRequired,closeElement:k.a.func.isRequired,closeElements:k.a.func.isRequired,dataElement:k.a.string.isRequired,toggleElement:k.a.func.isRequired});var I=B,W="AnnotationCreateRubberStamp",J={closeElements:r.a.closeElements,closeElement:r.a.closeElement,openElement:r.a.openElement,toggleElement:r.a.toggleElement};t.default=Object(a.c)((function(e){return{isDisabled:l.a.isElementDisabled(e,"stampOverlay"),isOpen:l.a.isElementOpen(e,"stampOverlay"),activeToolName:l.a.getActiveToolName(e),isActive:l.a.getActiveToolName(e)===W,toolButtonObjects:l.a.getToolButtonObjects(e),dataElement:l.a.getToolButtonObjects(e)[W].dataElement}}),J)(Object(o.a)()(Object(s.a)(I)))}}]);